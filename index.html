<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¯­æ–‡é­”æ³•å­¦å ‚ ğŸª</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary: #FF9F9F;
            --secondary: #A3E4D7;
            --accent: #FFD93D;
        }

        body {
            background: url('data:image/svg+xml,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20,50 Q40,25 60,50 T100,50" fill="%23FFE7E7"/></svg>') repeat-y,
                        linear-gradient(150deg, #FFF3E0 0%, #E8F5E9 100%);
            font-family: 'Comic Sans MS', cursive;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 30px;
            background: rgba(255,255,255,0.95);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .magic-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            border: 3px solid var(--primary);
            transition: transform 0.3s;
        }

        .cloud-input {
            padding: 15px;
            border: 3px solid var(--secondary);
            border-radius: 20px;
            font-size: 18px;
            background: #FFF;
            margin: 10px;
            width: 250px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
        }

        .starry-btn {
            background: linear-gradient(45deg, #FF9F9F, #FFD93D);
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .level-badge {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            position: absolute;
            right: -20px;
            top: -20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #FF9F9F, #FFD93D);
            color: white;
        }

        #chart {
            width: 100%;
            height: 400px;
            margin: 30px 0;
        }

        .advice-section {
            background: #FFF9EC;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border-left: 5px solid var(--accent);
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #uploadStatus {
            color: #6BCB77;
            margin-top: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ•™å¸ˆä¸Šä¼ åŒº -->
        <div class="magic-card">
            <h2>ğŸ§™â™€ï¸ æ•™å¸ˆé­”æ³•åŒº</h2>
            <input type="file" id="excelInput" accept=".xlsx">
            <p id="uploadStatus"></p>
        </div>

        <!-- å®¶é•¿æŸ¥è¯¢åŒº -->
        <div class="magic-card">
            <h2>ğŸ” é­”æ³•æŸ¥è¯¢é•œ</h2>
            <input type="text" class="cloud-input" placeholder="å°é­”æ³•å¸ˆå§“å" id="name">
            <input type="text" class="cloud-input" placeholder="å­¦å·é­”å’’" id="stuId">
            <button class="starry-btn" onclick="queryResult()">âœ¨ æ˜¾ç¤ºæˆç»©</button>
            
            <div id="result" style="display:none;">
                <div class="level-badge">A</div>
                <h3>ğŸ“œ è¯­æ–‡é­”æ³•æŠ¥å‘Š ğŸ“œ</h3>
                <div class="advice-section" id="suggestions"></div>
            </div>
        </div>

        <!-- æ•°æ®åˆ†æåŒº -->
        <div class="magic-card">
            <h2>ğŸ“ˆ å­¦ä¹ é­”æ³•åœ°å›¾</h2>
            <div id="chart"></div>
        </div>
    </div>

<script>
// æ•°æ®å­˜å‚¨åˆå§‹åŒ–
if(!localStorage.getItem('studentData')) {
    localStorage.setItem('studentData', JSON.stringify({}));
}

// Excelå¤„ç†é€»è¾‘
document.getElementById('excelInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(sheet);
            
            const existingData = JSON.parse(localStorage.getItem('studentData') || "{}");

            jsonData.forEach(item => {
                const key = `${item.å§“å}_${item.å­¦å·}`;
                if (!existingData[key]) {
                    existingData[key] = [];
                }
                existingData[key].push({
                    æ³¨éŸ³: item.æ³¨éŸ³æˆç»©,
                    è¯è¯­: item.è¯è¯­æˆç»©,
                    ç­‰çº§: calculateLevel(item.æ³¨éŸ³æˆç»©, item.è¯è¯­æˆç»©),
                    æ—¶é—´: new Date().toLocaleDateString()
                });
            });

            localStorage.setItem('studentData', JSON.stringify(existingData));
            document.getElementById('uploadStatus').textContent = 
                `âœ… æˆåŠŸå¯¼å…¥ ${jsonData.length} æ¡è®°å½•ï¼`;
                
            setTimeout(() => {
                document.getElementById('uploadStatus').textContent = '';
            }, 3000);

        } catch (error) {
            console.error('å¯¼å…¥å¤±è´¥:', error);
            document.getElementById('uploadStatus').textContent = 
                'âŒ æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨æ ‡å‡†æ¨¡æ¿';
            setTimeout(() => {
                document.getElementById('uploadStatus').textContent = '';
            }, 3000);
        }
    };
    
    reader.onerror = () => {
        document.getElementById('uploadStatus').textContent = 
            'âŒ æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•';
    };
    
    reader.readAsArrayBuffer(file);
});

// ç­‰çº§è®¡ç®—å‡½æ•°
function calculateLevel(pinyin, words) {
    const total = pinyin * 0.6 + words * 0.4;
    if(total >= 90) return 'A';
    if(total >= 75) return 'B';
    if(total >= 60) return 'C';
    return 'D';
}

// æ™ºèƒ½å»ºè®®ç”Ÿæˆå™¨
function generateAdvice(level, pinyin, words) {
    const baseAdvice = {
        A: {
            æ³¨éŸ³: "ğŸ‘ æ³¨éŸ³å°èƒ½æ‰‹ï¼å¯ä»¥æŒ‘æˆ˜å¤šéŸ³å­—å’Œæ–¹è¨€å‘éŸ³å·®å¼‚ç»ƒä¹ ",
            è¯è¯­: "ğŸ† è¯è¯­è¾¾äººï¼å»ºè®®å°è¯•æˆè¯­æ¥é¾™å’Œè¯è¯­åˆ†ç±»æ¸¸æˆ"
        },
        B: {
            æ³¨éŸ³: "ğŸ”Š æ³¨éŸ³è‰¯å¥½ï¼éœ€è¦åŠ å¼ºå‰åé¼»éŸ³åŒºåˆ†ç»ƒä¹ ",
            è¯è¯­: "ğŸ“š è¯è¯­æŒæ¡è‰¯å¥½ï¼å»ºè®®å¢åŠ å½¢è¿‘å­—è¾¨æç»ƒä¹ "
        },
        C: {
            æ³¨éŸ³: "ğŸ“¢ æ³¨éŸ³åŸºç¡€éœ€å·©å›ºï¼æ¯å¤©è·Ÿè¯»è¯¾æœ¬å½•éŸ³3é",
            è¯è¯­: "âœï¸ è¯è¯­éœ€è¦åŠ å¼ºï¼å»ºè®®æ¯å¤©å¬å†™10ä¸ªè¯¾æœ¬è¯è¯­"
        },
        D: {
            æ³¨éŸ³: "ğŸ’ª æ³¨éŸ³éœ€è¦ç‰¹è®­ï¼ä½¿ç”¨æ‹¼éŸ³å¡ç‰‡æ¯å¤©ç»ƒä¹ 30åˆ†é’Ÿ",
            è¯è¯­: "ğŸ†˜ è¯è¯­æ€¥éœ€åŠ å¼ºï¼ä»åŸºç¡€å­—è¯å¼€å§‹æ¯æ—¥å¬å†™"
        }
    }[level];

    const pinyinTips = pinyin < 85 ? [
        "â€¢ åˆ¶ä½œæ‹¼éŸ³å¡ç‰‡è¿›è¡Œé…å¯¹æ¸¸æˆ",
        "â€¢ ç”¨å½©è‰²ç¬”æ ‡æ³¨æ˜“é”™æ‹¼éŸ³",
        "â€¢ å½•åˆ¶è‡ªå·±çš„æœ—è¯»è¿›è¡Œå¯¹æ¯”"
    ] : [];

    const wordTips = words < 85 ? [
        "â€¢ åˆ¶ä½œè¯è¯­æ‰‘å…‹ç‰Œè¿›è¡Œç»„å¥æ¸¸æˆ",
        "â€¢ åœ¨ç”Ÿæ´»åœºæ™¯ä¸­å¯»æ‰¾å­¦è¿‡çš„è¯è¯­",
        "â€¢ ç”¨è¯è¯­ç¼–ç®€çŸ­çš„æ•…äº‹"
    ] : [];

    return `
        <h4>ğŸŒˆ å­¦ä¹ é­”æ³•æŒ‡å—ï¼š</h4>
        <p>ğŸ“Œ æ³¨éŸ³å»ºè®®ï¼š${baseAdvice.æ³¨éŸ³}</p>
        ${pinyinTips.map(t => `<p>âœ¨ ${t}</p>`).join('')}
        <p>ğŸ“Œ è¯è¯­å»ºè®®ï¼š${baseAdvice.è¯è¯­}</p>
        ${wordTips.map(t => `<p>âœ¨ ${t}</p>`).join('')}
        <p>â° æ¨èæ¯æ—¥å­¦ä¹ è®¡åˆ’ï¼š${getDailyPlan(level)}</p>
    `;
}

function getDailyPlan(level) {
    const plans = {
        A: "æ™¨è¯»15åˆ†é’Ÿ + æ‹“å±•é˜…è¯»20åˆ†é’Ÿ + åˆ›ä½œç»ƒä¹ 15åˆ†é’Ÿ",
        B: "æ™¨è¯»20åˆ†é’Ÿ + ä¸“é¡¹ç»ƒä¹ 15åˆ†é’Ÿ + å¤ä¹ 10åˆ†é’Ÿ", 
        C: "æ™¨è¯»30åˆ†é’Ÿ + åŸºç¡€ç»ƒä¹ 20åˆ†é’Ÿ + å¬å†™10åˆ†é’Ÿ",
        D: "æ™¨è¯»30åˆ†é’Ÿ + ä¸“é¡¹è®­ç»ƒ30åˆ†é’Ÿ + å®¶é•¿è¾…å¯¼15åˆ†é’Ÿ"
    };
    return plans[level];
}

// æŸ¥è¯¢åŠŸèƒ½
function queryResult() {
    const name = document.getElementById('name').value.trim();
    const stuId = document.getElementById('stuId').value.trim();
    if(!name || !stuId) return;

    const data = JSON.parse(localStorage.getItem('studentData') || {});
    const key = `${name}_${stuId}`;
    
    if(data[key]) {
        const latest = data[key][data[key].length - 1];
        document.getElementById('result').style.display = 'block';
        document.querySelector('.level-badge').textContent = latest.ç­‰çº§;
        document.getElementById('suggestions').innerHTML = 
            generateAdvice(latest.ç­‰çº§, latest.æ³¨éŸ³, latest.è¯è¯­);
        renderChart(data, key);
    }
}

// EChartså›¾è¡¨é…ç½®
function renderChart(data, key) {
    const chart = echarts.init(document.getElementById('chart'));
    const historyData = data[key] || [];
    
    const option = {
        tooltip: { 
            trigger: 'axis',
            formatter: function(params) {
                return `ğŸ“… ${params[0].axisValue}<br>
                        ğŸ“ æ³¨éŸ³ï¼š${params[0].data}åˆ†<br>
                        ğŸ“š è¯è¯­ï¼š${params[1].data}åˆ†`;
            }
        },
        legend: { 
            data: ['æ³¨éŸ³', 'è¯è¯­'],
            bottom: 10
        },
        xAxis: { 
            type: 'category', 
            data: historyData.map(d => d.æ—¶é—´),
            axisLabel: {
                rotate: 45,
                fontSize: 12
            }
        },
        yAxis: { 
            type: 'value', 
            max: 100,
            axisLabel: {
                formatter: '{value} åˆ†'
            }
        },
        series: [
            { 
                name: 'æ³¨éŸ³', 
                type: 'line', 
                data: historyData.map(d => d.æ³¨éŸ³),
                lineStyle: { color: '#FF9F9F' },
                itemStyle: { color: '#FF9F9F' },
                smooth: true,
                symbol: 'circle',
                symbolSize: 10
            },
            { 
                name: 'è¯è¯­', 
                type: 'line',
                data: historyData.map(d => d.è¯è¯­),
                lineStyle: { color: '#A3E4D7' },
                itemStyle: { color: '#A3E4D7' },
                smooth: true,
                symbol: 'rect',
                symbolSize: 10
            }
        ]
    };
    
    chart.setOption(option);
}
</script>
</body>
</html>